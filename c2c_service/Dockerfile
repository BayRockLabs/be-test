FROM python:3.11.9-slim-bullseye

WORKDIR /app

COPY . /app/
COPY tika-server-standard-2.6.0.jar /tmp/tika-server.jar

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        openjdk-11-jre

RUN java --version

RUN pip install -r requirements.txt && chmod a+x /app/entrypoint.sh

# Define ARGs and set them as ENVs
ARG DEBUG
ENV DEBUG $DEBUG

ARG MONTHLY
ENV MONTHLY $MONTHLY

ARG YEARLY
ENV YEARLY $YEARLY

ARG BI_WEEKLY
ENV BI_WEEKLY $BI_WEEKLY

ARG QUARTERLY
ENV QUARTERLY $QUARTERLY

ARG ACTIVE
ENV ACTIVE $ACTIVE

ARG INACTIVE
ENV INACTIVE $INACTIVE

ARG POTENTIAL_LEAD
ENV POTENTIAL_LEAD $POTENTIAL_LEAD

ARG ONBOARDED
ENV ONBOARDED $ONBOARDED

ARG US
ENV US $US

ARG LATAM
ENV LATAM $LATAM

ARG IND
ENV IND $IND

ARG EUR
ENV EUR $EUR

ARG USD
ENV USD $USD

ARG INR
ENV INR $INR

ARG EMPLOYEE
ENV EMPLOYEE $EMPLOYEE

ARG CONTRACTOR
ENV CONTRACTOR $CONTRACTOR

ARG EMPLOYEE_HOURLY
ENV EMPLOYEE_HOURLY $EMPLOYEE_HOURLY

ARG SUB_CONTRACTOR
ENV SUB_CONTRACTOR $SUB_CONTRACTOR

ARG ACCOUNT_URL
ENV ACCOUNT_URL $ACCOUNT_URL

ARG AZURE_CONTAINER_NAME
ENV AZURE_CONTAINER_NAME $AZURE_CONTAINER_NAME

ARG AZURE_CONNECTION_STRING
ENV AZURE_CONNECTION_STRING $AZURE_CONNECTION_STRING

ARG DB_HOSTNAME
ENV DB_HOSTNAME $DB_HOSTNAME

ARG DB_USERNAME
ENV DB_USERNAME $DB_USERNAME

ARG DB_PASSWORD
ENV DB_PASSWORD $DB_PASSWORD

ARG DB_NAME
ENV DB_NAME $DB_NAME

ARG DB_PORT
ENV DB_PORT $DB_PORT

ARG AUTH_API
ENV AUTH_API $AUTH_API

ARG PROFILE
ENV PROFILE $PROFILE

ARG MPS_DOCUMENT_PARSER_API
ENV MPS_DOCUMENT_PARSER_API $MPS_DOCUMENT_PARSER_API

ARG OPENAI_API
ENV OPENAI_API $OPENAI_API

ARG SCHEDULER_DAY
ENV SCHEDULER_DAY $SCHEDULER_DAY

ARG SCHEDULER_HOUR
ENV SCHEDULER_HOUR $SCHEDULER_HOUR

ARG SCHEDULER_MINUTE
ENV SCHEDULER_MINUTE $SCHEDULER_MINUTE

ARG SCHEDULER_TIMEZONE
ENV SCHEDULER_TIMEZONE $SCHEDULER_TIMEZONE

# Expose port 8000
EXPOSE 8000

# Start Tika server and Python app
CMD ["bash", "-c", "/app/entrypoint.sh"]